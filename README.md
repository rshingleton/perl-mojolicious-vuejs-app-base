# Perl Mojolicious and Vue3

This template should help get you started developing with Vue 3 in Vite with Mojolicious.

This project uses [a small Perl base image](https://github.com/rshingleton/alpine-perl-docker) that is around 65Mb with a multi-stage build that results in a final image
of around 67Mb. Your resulting image sizes may vary based on what dependencies you add to the mix.

### Perl Dependencies
To add additional Perl dependencies, use the 
[cpanfile](https://metacpan.org/dist/Module-CPANfile/view/lib/cpanfile.pod). Initially the project only has a single
dependency of Mojolicious

cpanfile
```
# version: 0.01
requires 'Mojolicious';
```

### Mojolicious
To handle the static assets that Vue produces, I added a route controller that serves the index.html
that is produced after running npm run build. In the docker build process, the dist folder is copied 
to /app/public. Requests coming into the base url / are routed to the controller MojoVue::Vue::index

MojoVue.pm
```perl5
  # Normal route to controller
  $r->get('/')->to('Vue#index');
```

In ./lib/MojoVue/Controller/Vue.pm the index subroutine returns the static index.html file from ./public
```perl5
sub index($self) {
    # Serves up index.html from the public directory
    $self->reply->static('index.html');
}
```

### Handling vue routes
To handle vue routes using vue-router, we need to add a "catch-all" Mojolicious route handler. The last route in MojoVue.pm does this:

MojoVue.pm
```perl5
# handle vue router, routes anything that does not match previous
# definitions to vue. 404 should be handled in the vue router
$r->any('/*')->to('Vue#index');
```

This will route any routes that do not match defined Mojolicious routes to the vue-router.

### Vue Single Page Applications (SPA)
You can also mix in or build a project with many single page apps using Mojolicious templates and Vue.js.

MojoVue.pm 
```perl5
$r->get('/hello')->to('Vue#hello');
```
This Mojolicious route sends the request to ./lib/MojoVue/Controller/Vue.pm and serves up the template 
from templates/vue/hello.html.ep which is a Vue SPA.

## Autogenerated documentation from Vue
## Recommended IDE Setup

[VSCode](https://code.visualstudio.com/) + [Volar](https://marketplace.visualstudio.com/items?itemName=Vue.volar) (and disable Vetur) + [TypeScript Vue Plugin (Volar)](https://marketplace.visualstudio.com/items?itemName=Vue.vscode-typescript-vue-plugin).

## Customize configuration

See [Vite Configuration Reference](https://vitejs.dev/config/).

## Project Setup

```sh
npm install
```

### Compile and Hot-Reload for Development

```sh
npm run dev
```

### Compile and Minify for Production

```sh
npm run build
```

### Lint with [ESLint](https://eslint.org/)

```sh
npm run lint
```

## Docker Misc
### Docker Build
```sh
docker build --tag mojo-vue:latest .
```

### Docker Run
```sh
docker run -it --init -p 8080:8080 mojo-vue
```